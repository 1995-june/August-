<!--
 * @Author: your name
 * @Date: 2021-08-25 22:29:42
 * @LastEditTime: 2021-08-27 15:13:55
 * @LastEditors: Please set LastEditors
 * @Description: In User Settings Edit
 * @FilePath: \HTML排版案例d:\八月没有六月好\20210823-day-13\每日优鲜\html\shoppingCart.html
-->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width = device-width,
    user-scalable = no,
    initial-scale = 1.0,
    maximum-scale = 1.0,
    minimum-scale = 1.0" />
    <title>购物车</title>
    <link rel="stylesheet" href="../css/shoppingCart.css">
    <link rel="stylesheet" href="../fonts/iconfont.css">
</head>

<body>
    <div id="wrap">
        <div class="title">
            <h2>购物车</h2>
        </div>
        <div class="header">
            <div class="header-address">
                <div class="left-address">
                    <i class="iconfont icon-location"></i> <a href="../html/receivingAddress.html">郑州市中原区政协</a>
                </div>
                <div class="right-remove">
                    <button type="button">删除</button>
                </div>
            </div>
        </div>
        <div class="main">
            <div class="content">
                <div class="sow">
                    <div class="goods-count-wrap">
                        <div class="top-all">
                            <input type="checkbox" class="all" name="checkbox">
                            <ul class="characteristic-one">
                                <li class="active">云超特卖</li>
                                <li>最快次日达</li>
                            </ul>
                        </div>
                        <div class="goods-count">
                            <div class="bj-goods"></div>
                        </div>
                    </div>
                </div>
                <div class="empty-wrap">
                    <img src="../images/img_20181204113632737.gif" alt="">
                </div>
                <div class="seckill-wrap">
                    <div class="seckill">
                        <div class="left-seckill">
                            <div class="title-wrap">
                                <h3>今日秒杀</h3>
                                <div class="count-down">
                                    <span>03</span><b>:</b><span>28</span><b>:</b><span>12</span>
                                </div>
                                <p>精选推荐 限时折扣</p>
                            </div>
                            <div class="con-img">
                                <dl>
                                    <dt><img src="../images/速食面_10.jpg"></dt>
                                    <dd>￥61</dd>
                                </dl>
                                <dl>
                                    <dt><img src="../images/速食面_10.jpg"></dt>
                                    <dd>￥61</dd>
                                </dl>
                            </div>
                        </div>
                        <div class="right-supermarket">
                            <div class="title-wrap">
                                <h3>今日超市</h3>
                                <div class="count-down">
                                    <img src="../images/微信图片_20210727145629_05.jpg" alt="">
                                </div>
                                <p>精选推荐 限时折扣</p>
                            </div>
                            <div class="con-img">
                                <dl>
                                    <dt><img src="../images/刘莱_03.jpg"></dt>
                                    <dd>￥61</dd>
                                </dl>
                                <dl>
                                    <dt><img src="../images/刘莱_03.jpg"></dt>
                                    <dd>￥61</dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tex">
                    <h5>--- 猜你喜欢 ---</h5>
                </div>
                <div class="goods-wrap">
                    <div class="goods-list">
                        <div class="goods">
                        </div>
                        <div class="up">上拉加载更多</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer">
            <div class="footer-nav">
                <a href="../index.html">
                    <dl>
                        <dt>
                            <img src="../images/home-active.5f430fd.png" alt="">
                        </dt>
                        <dd>首页</dd>
                    </dl>
                </a>
                <a href="./homeClassification.html">
                    <dl>
                        <dt>
                            <img src="../images/下载 (2).png" alt="">
                        </dt>
                        <dd>分类</dd>
                    </dl>
                </a>
                <a href="#">
                    <dl>
                        <dt>
                            <img src="../images/下载 (4).png" alt="">
                            </dt>
                        <dd>购物车
                            <span class="num">0</span>
                        </dd>
                    </dl>
                </a>
                <a href="#">
                    <dl>
                        <dt>
                            <img src="../images/下载 (5).png" alt="">
                        </dt>
                        <dd>我的</dd>
                    </dl>
                </a>
            </div>
        </div>
    </div>
    <script src="../lib/bscroll .js"></script>
    <script src="../js/ajax.js"></script>
    <script src="../js/shoppingCart.js"></script>
    <script>
        var pullUp = document.querySelector('.up')

        var bs = new BScroll('.main', {
            probeType: 2,
            // 0 ~ 1 代表手指不在屏幕滑动  2 代表手指在屏幕滑动 3 代表手指离开屏幕
            pullDownRefresh: { // 选项对象
                threshold: 90, // 配置顶部下拉的距离来决定刷新时机。
                stop: 40 //回弹悬停的距离。  
            },
            // 触发上拉事件的阈值。
            pullUpLoad: {
                threshold: 90,
                stop: 40 //回弹悬停的距离。  
            },
            click: true
        })

        var goods = document.querySelector('.goods-wrap > .goods-list > .goods');

        // 当顶部下拉的距离大于 threshold 值时，触发一次 pullingDown
        bs.on('pullingUp', function() {
            pullUp.innerHTML = '正在加载';
            ajax('../lib/data.json', 'get', {}, function(res) {
                console.log(res);
                setTimeout(function() {
                    renderUpDara(res);
                    bs.finishPullUp(); //结束上拉加载行为。
                    bs.refresh();
                }, 1000)
            })
        })

        function renderUpDara(res) {
            var item = res.list;
            goods.innerHTML += item.map(function(val) {
                return `
            <dl>
                <dt>
                    <a href="#"><img src="${val.img}" alt=""></a>
                </dt>
                <dd>
                    <h6>${val.goods_name}</h6>
                    <p>${val.desc}</p>
                    <div class="subtitle-wrap">
                        <span>任选两件</span>
                        <span>最快次日达</span>
                    </div>
                    <div class="price-wrap">
                        <span>￥${val.goods_price}</span> <button type="button">+</button>
                    </div>
                </dd>
            </dl>`
            })
            var dl = goods.querySelectorAll('dl');
            PageEvent(dl)
        }

        function PageEvent(dl) {
            dl.forEach((val) => {
                val.addEventListener('touchend', function() {
                    var dataObj = {
                        "img": this.children[0].children[0].children[0].src,
                        "title": this.children[1].children[0].innerHTML,
                        "con": this.children[1].children[1].innerHTML,
                        "subtitle": this.children[1].children[2].children[0].innerHTML,
                        "price": this.children[1].children[3].children[0].innerHTML,
                    }
                    localStorage.setItem('pageData', JSON.stringify(dataObj));
                    location.href = '../html/details.html';
                })
            })
        }

        // 获取本地存储
        var addressWrap = document.querySelector('.left-address > a');
        var arr = JSON.parse(localStorage.getItem('cityLis'));
        addressWrap.innerHTML = arr.con;

        var goodesAdd = JSON.parse(localStorage.getItem('goodesAdd'));
        console.log(goodesAdd);
        var bjGoods = document.querySelector('.bj-goods');

        bjGoods.innerHTML += goodesAdd.map(item => {
            return `
                <div class="certer-con">
                    <input type="checkbox" class="single-choice" name="checkbox">
                    <dl>
                        <dt>
                            <img src="${item.img}" alt="">
                        </dt>
                        <dd>
                            <p>${item.name}</p>
                            <div class="price-wrap">
                                <span>${item.price}</span>
                                <div class="btn-wrap">
                                    <div class="reduce-btn"><button>一</button></div>
                                    <input type="text" name="text" value="1">
                                    <div class="daa-btn"><button>+</button></div>
                                </div>
                            </div>
                        </dd>
                    </dl>
                </div>
                <div class="distribution-wrap"><p>云超特卖：以免配送费</p></div>`;
        }).join('')



        var footer = document.querySelector('.footer')
        var num = footer.querySelector('.num')
        num.style.display = 'block';
        // num.innerHTML = goodesAdd.add;
    </script>
</body>

</html>