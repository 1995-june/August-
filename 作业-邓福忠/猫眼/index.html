<!--
 * @Author: your name
 * @Date: 2021-08-11 15:16:59
 * @LastEditTime: 2021-08-21 08:36:52
 * @LastEditors: Please set LastEditors
 * @Description: In User Settings Edit
 * @FilePath: \HTML排版案例d:\八月没有六月好\20210811-day-6\猫眼\index.html
-->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width = device-width,
    user-scalable = no,
    initial-scale = 1.0,
    maximum-scale = 1.0,
    minimum-scale = 1.0" />
    <title>猫眼</title>
    <link rel="stylesheet" href="./css/base.css">
    <link rel="stylesheet" href="./css/index.css">
</head>

<body>
    <div id="wrap">
        <!-- 头部 -->
        <div class="header">
            <!-- 头部菜单 -->
            <div class="header-nav">
                <h2>猫眼电影</h2>
                <div class="right-menu">
                    <img src="https://p0.meituan.net/scarlett/f05f61e7a8f3f45fd071c068d7a26870356.png" alt="">
                </div>
            </div>
            <!-- 头部 logo -->
            <div class="header-app">
                <div class="logo">
                    <img src="https://p0.meituan.net/scarlett/448afce485c1f342895185c2be668fa411803.png" alt="">
                </div>
                <span>发现最新最热电影</span>
                <span>打开App
                            <img src="https://p0.meituan.net/scarlett/70a18c9d3c345f442e5a4e6bf2d16180779.png" alt="">
                </span>
            </div>
            <div class="nav-menu">
                <div class="topbar">
                    <div class="city">
                        <a href="./html/city.html">
                            <h6>北京</h6><b></b></a>
                    </div>
                    <nav>
                        <a href="#" data-key="well-received" class="active">热映</a>
                        <a href="#" data-key="cinema">影院</a>
                        <a href="#" data-key="to-be-shown">待映</a>
                        <a href="#" data-key="classic">经典电影</a>
                    </nav>
                    <a href="./html/search.html">
                        <div class="icon-search"></div>
                    </a>
                </div>
            </div>
        </div>
        <!-- 内容 -->
        <div class="main">
            <div class="well-received visible">
                <div class="title">
                    <h3>最受好评电影</h3>
                </div>
                <div class="tab-content">
                    <div class="top-praise-film">
                        <div class="praise-film-content">
                            <dl>
                                <dt>
                            <img src="https://p1.meituan.net/170.230/movie/1a989d7c2698d4c3e8713eac69edcef83182854.jpg" alt="">
                        </dt>
                                <dd>我的父亲焦裕禄</dd>
                            </dl>
                            <dl>
                                <dt>
                            <img src="https://p1.meituan.net/170.230/movie/1a989d7c2698d4c3e8713eac69edcef83182854.jpg" alt="">
                        </dt>
                                <dd>我的父亲焦裕禄</dd>
                            </dl>
                            <dl>
                                <dt>
                            <img src="https://p1.meituan.net/170.230/movie/1a989d7c2698d4c3e8713eac69edcef83182854.jpg" alt="">
                        </dt>
                                <dd>我的父亲焦裕禄</dd>
                            </dl>
                            <dl>
                                <dt>
                            <img src="https://p1.meituan.net/170.230/movie/1a989d7c2698d4c3e8713eac69edcef83182854.jpg" alt="">
                        </dt>
                                <dd>我的父亲焦裕禄</dd>
                            </dl>
                            <dl>
                                <dt>
                            <img src="https://p1.meituan.net/170.230/movie/1a989d7c2698d4c3e8713eac69edcef83182854.jpg" alt="">
                        </dt>
                                <dd>我的父亲焦裕禄</dd>
                            </dl>
                            <dl>
                                <dt>
                            <img src="https://p1.meituan.net/170.230/movie/1a989d7c2698d4c3e8713eac69edcef83182854.jpg" alt="">
                        </dt>
                                <dd>我的父亲焦裕禄</dd>
                            </dl>
                            <dl>
                                <dt>
                            <img src="https://p1.meituan.net/170.230/movie/1a989d7c2698d4c3e8713eac69edcef83182854.jpg" alt="">
                        </dt>
                                <dd>我的父亲焦裕禄</dd>
                            </dl>
                            <dl>
                                <dt>
                            <img src="https://p1.meituan.net/170.230/movie/1a989d7c2698d4c3e8713eac69edcef83182854.jpg" alt="">
                        </dt>
                                <dd>我的父亲焦裕禄</dd>
                            </dl>
                            <dl>
                                <dt>
                            <img src="https://p1.meituan.net/170.230/movie/1a989d7c2698d4c3e8713eac69edcef83182854.jpg" alt="">
                        </dt>
                                <dd>我的父亲焦裕禄</dd>
                            </dl>
                            <dl>
                                <dt>
                            <img src="https://p1.meituan.net/170.230/movie/1a989d7c2698d4c3e8713eac69edcef83182854.jpg" alt="">
                        </dt>
                                <dd>我的父亲焦裕禄</dd>
                            </dl>
                            <dl>
                                <dt>
                            <img src="https://p1.meituan.net/170.230/movie/1a989d7c2698d4c3e8713eac69edcef83182854.jpg" alt="">
                        </dt>
                                <dd>我的父亲焦裕禄</dd>
                            </dl>
                            <dl>
                                <dt>
                            <img src="https://p1.meituan.net/170.230/movie/1a989d7c2698d4c3e8713eac69edcef83182854.jpg" alt="">
                        </dt>
                                <dd>我的父亲焦裕禄</dd>
                            </dl>
                            <dl>
                                <dt>
                            <img src="https://p1.meituan.net/170.230/movie/1a989d7c2698d4c3e8713eac69edcef83182854.jpg" alt="">
                        </dt>
                                <dd>我的父亲焦裕禄</dd>
                            </dl>
                            <dl>
                                <dt>
                            <img src="https://p1.meituan.net/170.230/movie/1a989d7c2698d4c3e8713eac69edcef83182854.jpg" alt="">
                        </dt>
                                <dd>我的父亲焦裕禄</dd>
                            </dl>
                            <dl>
                                <dt>
                            <img src="https://p1.meituan.net/170.230/movie/1a989d7c2698d4c3e8713eac69edcef83182854.jpg" alt="">
                        </dt>
                                <dd>我的父亲焦裕禄</dd>
                            </dl>
                            <dl>
                                <dt>
                            <img src="https://p1.meituan.net/170.230/movie/1a989d7c2698d4c3e8713eac69edcef83182854.jpg" alt="">
                        </dt>
                                <dd>我的父亲焦裕禄</dd>
                            </dl>
                        </div>
                    </div>
                </div>
                <div class="con-wrap">
                    <div class="con">
                        <div class="w-content">
                            <div class="rotate"></div>
                            <div class="down base">下拉刷新</div>
                            <div class="list"></div>
                            <div class="up base">上拉加载</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="cinema">22222</div>
            <div class="to-be-shown">33333</div>
            <div class="classic">44444</div>
        </div>

        <!-- 页脚 -->
        <div class="footer">
            <div class="footer-nav">
                <a href="./index.html">
                    <dl>
                        <dt>
                        <img src="https://p0.meituan.net/scarlett/551cc48b3a71478a57b40ac4a00179d61401.png">
                    </dt>
                        <dd>电影/影院</dd>
                    </dl>
                </a>
                <a href="./html/video.html">
                    <dl>
                        <dt>
                            <img src="https://p0.meituan.net/scarlett/58a786cefee2770a152ed50c992a864b1254.png">
                        </dt>
                        <dd>视频</dd>
                    </dl>
                </a>
                <a href="./html/smallVideo.html">
                    <dl>
                        <dt>
                            <img src="https://p0.meituan.net/scarlett/58a786cefee2770a152ed50c992a864b1254.png">
                        </dt>
                        <dd>小视频</dd>
                    </dl>
                </a>
                <a href="./html/show.html">
                    <dl>
                        <dt>
                            <img src="https://p0.meituan.net/scarlett/58a786cefee2770a152ed50c992a864b1254.png">
                        </dt>
                        <dd>演出</dd>
                    </dl>
                </a>
                <a href="./html/my.html">
                    <dl>
                        <dt>
                            <img src="https://p0.meituan.net/scarlett/58a786cefee2770a152ed50c992a864b1254.png">
                        </dt>
                        <dd>我的</dd>
                    </dl>
                </a>
            </div>
        </div>
    </div>
    <script src="./js/ajax (4).js"></script>
    <script src="./js/pageRender.js"></script>
    <script src="./common/bScroll.js"></script>
    <script>
        var pullDown = document.querySelector('.w-content .down');
        var pullUp = document.querySelector('.up');
        var lisWrap = document.querySelector('.list')
        var rotate = document.querySelector('.rotate')
            // 滚动
        new BScroll('.tab-content', {
            scrollX: true,
        })

        var bs = new BScroll('.con', {
            pullDownRefresh: { // 选项对象
                threshold: 50, // 配置顶部下拉的距离来决定刷新时机。
                stop: 60 //回弹悬停的距离。  
            },

            // 触发上拉事件的阈值。
            pullUpLoad: {
                threshold: 50,
                stop: 60 //回弹悬停的距离。  
            },

            click: true
        })

        // 当顶部下拉的距离大于 threshold 值时，触发一次 pullingDown
        bs.on('pullingDown', function() {
            pullDown.innerHTML = '正在刷新';
            rotate.style.animation = 'rotate 2s linear infinite';
            ajax('./common/data.json', 'get', {}, function(res) {
                var lis = res.movieList;
                setTimeout(function() {
                    renderDomnDara(lis);
                    bs.finishPullDown(); // 结束下拉刷新行为。
                    rotate.style.animation = 'none';
                    bs.refresh();
                }, 3000)
            })
        })

        function renderDomnDara(res) {
            lisWrap.innerHTML = res.map(function(item) {
                return `<dl>
                        <dt><img src="${item.img}" alt=""></dt>
                        <dd>
                            <h4>${item.nm}</h4>
                            <span>观众评 <b>${item.sc}</b></span>
                            <p class="to-star">${item.star}</p>
                            <p>${item.showInfo}</p>
                            <a href="#" class="ticket">购票</a>
                        </dd>
                    </dl>`;
            }).join('')
            var dl = document.querySelectorAll('.list > dl');
            storage(dl)
        }

        // 当顶部下拉的距离大于 threshold 值时，触发一次 pullingDown
        bs.on('pullingUp', function() {
            pullUp.innerHTML = '正在加载';
            ajax('./common/data.json', 'get', {}, function(res) {
                var lis = res.movieList;
                setTimeout(function() {
                    renderUpDara(lis);
                    bs.finishPullUp(); //结束上拉加载行为。
                    bs.refresh();
                }, 3000)
            })
        })

        function renderUpDara(res) {
            lisWrap.innerHTML += res.map(function(item) {
                return `<dl>
                        <dt><img src="${item.img}" alt=""></dt>
                        <dd>
                            <h4>${item.nm}</h4>
                            <span>观众评 <b>${item.sc}</b></span>
                            <p class="to-star">${item.star}</p>
                            <p>${item.showInfo}</p>
                            <a href="#" class="ticket">购票</a>
                        </dd>
                    </dl>`;
            }).join('');
            var dl = document.querySelectorAll('.list > dl');
            storage(dl)
        }

        function storage(dl) {
            var arr = JSON.parse(localStorage.getItem('cityLis')); // 转成 js对象
            var h6 = document.querySelector('.city>a>h6');
            var dl = document.querySelectorAll('.list > dl');
            h6.innerHTML = arr.city;

            dl.forEach((val) => {
                val.addEventListener('click', () => {
                    var inner = {
                        "img": val.children[0].children[0].src,
                        "h4": val.children[1].children[0].innerHTML,
                        "span": val.children[1].children[1].innerHTML,
                        "b": val.children[1].children[1].children[0].innerHTML,
                        'p1': val.children[1].children[2].innerHTML,
                        'p2': val.children[1].children[3].innerHTML,
                    }
                    localStorage.setItem('dl', JSON.stringify(inner)); // 设置被本地数据为JSON字符串
                    location.href = './html/detailPage.html'; //Location 接口表示其链接到的对象的位置（URL）。
                })
            })
        }
    </script>

</body>

</html>

</html>